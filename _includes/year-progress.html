<script src="/assets/js/moment.min.js"></script>

<div class="columns is-vcentered">
  <div class="column is-4">
    <p id="date"></p>
    <p id="clock"></p>
    <p id="weekNumber"></p>
    <p id="year-ratio"></p>
    <p id="year-percent"></p>
  </div>
  <div class="column is-8">
    <ul class="days"></ul>
  </div>
</div>

<style>
  :root {
    --point-size: 0.27rem;
    --point-gap: 0.27rem;
    --row-gap: 0.36rem;
  }

  .days {
    list-style-type: none;
    display: grid;
    grid-auto-flow: row;
    grid-gap: var(--point-gap);
    row-gap: var(--row-gap);
    grid-auto-rows: var(--point-size);
    grid-template-columns: repeat(31, var(--point-size));
    grid-area: days;
    width: max-content;
  }

  .days li {
    margin: 0;
    border-radius: 50%;
  }

  .weekday { background-color: #fff; }
  .filler { background-color: inherit; }
  .past { opacity: 0.5; }
  .weekend { background-color: #ffcc00e2; }
  .now { background-color: rgb(255, 55, 0); }

  html[data-theme='light'] {
    .weekday { background-color: #b2afaf; }
    .now { background-color: rgb(255, 55, 0); }
  }
</style>

<script>
  (function() {
    // Constants and state values
    const today = moment();
    const currentDayOfYear = today.dayOfYear();
    const yearPercent = Math.round((currentDayOfYear / 365) * 100);
    const currentWeek = today.isoWeek();
    const formattedDate = today.format('dddd, MMMM DD');
    const daysContainer = document.querySelector(".days");
    
    // Update text displays (date, progress, etc)
    function updateTextElements() {
      document.querySelector("#date").innerHTML = formattedDate;
      document.querySelector("#year-ratio").innerHTML = `Day ${currentDayOfYear}`;
      document.querySelector("#weekNumber").innerHTML = `Week ${currentWeek}`;
      document.querySelector("#year-percent").innerHTML = `%${yearPercent}`;
    }
    
    // Setup and update clock
    function setupClock() {
      function updateClock() {
        const now = new Date();
        const hours = now.getHours().toString().padStart(2, '0');
        const minutes = now.getMinutes().toString().padStart(2, '0');
        const seconds = now.getSeconds().toString().padStart(2, '0');
        document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds}`;
      }
      
      setInterval(updateClock, 1000);
      updateClock();
    }
    
    // Get data for all months
    function getMonthsData() {
      return Array.from({ length: 12 }, (_, month) => {
        const daysInMonth = moment().month(month).daysInMonth();
        const weekendDays = getWeekendDaysForMonth(month, daysInMonth);
        return { daysInMonth, weekendDays };
      });
    }
    
    // Get weekend days for a specific month
    function getWeekendDaysForMonth(month, daysInMonth) {
      const weekendDays = [];
      
      for (let day = 1; day <= daysInMonth; day++) {
        const date = moment().month(month).date(day);
        if (date.day() === 0 || date.day() === 6) {
          weekendDays.push(day);
        }
      }
      
      return weekendDays;
    }
    
    // Create a single day element with proper classes
    function createDayElement(day, weekendDays, dayNumber, currentDayOfYear) {
      const dayElement = document.createElement("li");
      
      if (weekendDays.includes(day)) {
        dayElement.classList.add("weekend");
      } else {
        dayElement.classList.add("weekday");
      }
      
      if (dayNumber === currentDayOfYear) {
        dayElement.classList.add("now");
      } else if (dayNumber < currentDayOfYear) {
        dayElement.classList.add("past");
      }
      
      return dayElement;
    }
    
    // Create empty filler element
    function createFillerElement() {
      const filler = document.createElement("li");
      filler.classList.add("filler");
      return filler;
    }
    
    // Add multiple filler elements
    function addFillerDays(container, count) {
      for (let i = 0; i < count; i++) {
        container.appendChild(createFillerElement());
      }
    }
    
    // Render the entire calendar grid
    function renderCalendar() {
      let dayCounter = 0;
      const monthsData = getMonthsData();
      
      monthsData.forEach(({ daysInMonth, weekendDays }, monthIndex) => {
        // Add row separator every 3 months
        if (monthIndex % 3 === 0) {
          addFillerDays(daysContainer, 31);
        }
        
        // Add actual day elements for the month
        for (let day = 1; day <= daysInMonth; day++) {
          dayCounter++;
          const dayElement = createDayElement(day, weekendDays, dayCounter, currentDayOfYear);
          daysContainer.appendChild(dayElement);
        }
        
        // Fill remaining grid positions to maintain layout
        const fillerDaysNeeded = 31 - daysInMonth;
        addFillerDays(daysContainer, fillerDaysNeeded);
      });
    }
    
    // Initialize everything
    function init() {
      updateTextElements();
      setupClock();
      renderCalendar();
    }
    
    init();
  })();
</script>